# DarlyDjango - Книжный интернет-магазин

Веб-приложение интернет-магазина книг, построенное на Django с фронтендом на Tailwind CSS и Vite. Приложение включает каталог товаров с категориями и поиском, корзину покупок, оформление заказов, систему отзывов и авторизацию пользователей с ролевой моделью доступа.

---

## Стек технологий

### Backend
- Python 
- Django - веб-фреймворк
- SQLite - база данных
- django-crispy-forms - рендеринг форм
- django-vite - интеграция с Vite
- Pillow - обработка изображений
- Loguru - логирование

### Frontend
- Vite - сборщик
- Tailwind CSS - CSS-фреймворк
- PostCSS - пост-обработка CSS

---

## Установка и запуск

### Предварительные требования

- Python 3.10+
- Node.js 18+
- npm или yarn

### Первоначальная настройка

1. **Клонирование репозитория**

```bash
git clone https://github.com/Darlykn/DarlyDjango.git
cd DarlyDjango
```

2. **Создание и активация виртуального окружения**

```bash
python -m venv venv
venv\Scripts\activate        # Windows
# source venv/bin/activate   # Linux / macOS
```

3. **Установка Python-зависимостей**

```bash
pip install -r requirements.txt
```

4. **Установка frontend-зависимостей**

```bash
cd frontend
npm install
cd ..
```

5. **Применение миграций базы данных**

```bash
cd django_shop
python manage.py makemigrations
python manage.py migrate
```

6. **Создание суперпользователя**

```bash
python manage.py createsuperuser
```

### Запуск приложения

#### Локальный запуск (режим разработки)

Запустите два терминала:

**Терминал 1 -- Django-сервер:**

```bash
cd django_shop
python manage.py runserver
```

**Терминал 2 -- Vite dev-сервер (HMR):**

```bash
cd frontend
npm run dev
```

> При работе с Vite dev-сервером убедитесь, что в `settings.py` установлено `VITE_DEV_MODE = True`.

Приложение будет доступно по адресу: **http://localhost:8000**

#### Локальный запуск (без Vite dev-сервера)

Если не нужен HMR и горячая перезагрузка, можно запустить проект без Vite dev-сервера. Для этого сначала соберите фронтенд, а затем запустите Django:

1. **Сборка фронтенда**

```bash
cd frontend
npm run build
```

2. **Установите `VITE_DEV_MODE = False` в `settings.py`**

3. **Запустите Django-сервер**

```bash
cd django_shop
python manage.py runserver
```

Приложение будет доступно по адресу: **http://localhost:8000**

---

## Структура проекта

```
DarlyDjango/
|-- django_shop/                     # Основной Django-проект
|   |-- django_shop/                 # Настройки проекта
|   |   |-- settings.py              # Конфигурация Django
|   |   |-- urls.py                  # Корневая маршрутизация
|   |   |-- wsgi.py                  # WSGI-конфигурация
|   |   +-- static/                  # Статические файлы (сборка)
|   |
|   |-- shop/                        # Приложение: каталог товаров
|   |   |-- models.py                # Модели: Product, Category, Review
|   |   |-- views.py                 # Представления каталога
|   |   |-- urls.py                  # URL-маршруты магазина
|   |   |-- forms.py                 # Формы отзывов
|   |   |-- admin.py                 # Настройка админ-панели
|   |   |-- utils.py                 # DataMixin -- вспомогательный класс
|   |   |-- context_processors.py    # Контекст категорий
|   |   +-- templates/               # Шаблоны магазина
|   |
|   |-- cart/                        # Приложение: корзина покупок
|   |   |-- cart_services.py         # Логика корзины (сессии)
|   |   |-- views.py                 # Представления корзины
|   |   |-- urls.py                  # URL-маршруты корзины
|   |   |-- forms.py                 # Формы корзины
|   |   +-- context_processors.py    # Контекст итоговой суммы
|   |
|   |-- orders/                      # Приложение: заказы
|   |   |-- models.py                # Модели: Order, OrderProduct
|   |   |-- views.py                 # Представления заказов
|   |   |-- urls.py                  # URL-маршруты заказов
|   |   |-- admin.py                 # Админка с ролевым доступом
|   |   |-- forms.py                 # Форма оформления заказа
|   |   +-- signals.py               # Автообновление стоимости заказа
|   |
|   |-- users/                       # Приложение: пользователи
|   |   |-- models.py                # Модель: CustomUser
|   |   |-- views.py                 # Авторизация и регистрация
|   |   |-- urls.py                  # URL-маршруты пользователей
|   |   |-- admin.py                 # Управление пользователями
|   |   +-- forms.py                 # Формы входа и регистрации
|   |
|   |-- templates/                   # Глобальные шаблоны
|   |-- media/                       # Загруженные изображения
|   +-- manage.py                    # Скрипт управления Django
|
|-- frontend/                        # Frontend-ресурсы
|   |-- src/
|   |   |-- main.js                  # Точка входа JS
|   |   +-- main.css                 # Tailwind CSS + кастомные стили
|   |-- vite.config.js               # Конфигурация Vite
|   |-- package.json                 # Frontend-зависимости
|   +-- postcss.config.js            # Конфигурация PostCSS
|
|-- docker-compose.yml               # Docker Compose
|-- Dockerfile                       # Образ Docker
|-- requirements.txt                 # Python-зависимости
+-- README.md
```

---

## Функционал

### Каталог товаров
- Просмотр списка книг с пагинацией (32 товара на страницу)
- Фильтрация по категориям
- Поиск по названию книги и автору (с поддержкой кириллицы)
- Детальная страница товара с изображением и описанием
- Отображение средней оценки по отзывам

### Корзина покупок
- Сессионная корзина (без авторизации)
- Добавление и удаление товаров
- Изменение количества
- Автоматический расчёт итоговой стоимости
- Проверка наличия товара на складе

### Оформление заказов
- Создание заказа из корзины (требуется авторизация)
- Указание адреса доставки
- Автоматическое списание товара со склада
- Статусы заказа: ожидание -> обработка -> отправлен -> доставлен
- История заказов пользователя
- Автоматический пересчёт итоговой стоимости

### Авторизация и пользователи
- Кастомная модель пользователя (вход по email)
- Регистрация с валидацией данных
- Автоматический вход после регистрации
- Ролевая модель доступа:
  - **Администратор** -- полный доступ ко всем разделам
  - **Менеджер** -- управление статусами заказов
  - **Пользователь** -- просмотр каталога, покупки, отзывы

### Система отзывов
- Отзыв могут оставить только покупатели с доставленным заказом
- Один отзыв на товар от одного пользователя
- Оценка от 1 до 5 и текстовый комментарий
- Средний рейтинг отображается на карточке товара

### Административная панель
- Управление товарами с превью изображений
- Управление заказами с ролевыми ограничениями
- Валидация переходов статусов (менеджер может только продвигать статус)
- Управление пользователями и их ролями
